name: schedule
on:
  schedule:
    - cron: "0 6 * * *"
#  push:
#    branches: [ master ]
#  pull_request:
#    branches: [ master ]
jobs:
  eins:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        path: main
    - name: Checkout Remote
      uses: actions/checkout@v3
      with:
        repository: pcloudcom/console-client
        ref: master
        path: remote
    - name: Set ENV variables
      run: |
        echo "REMOTE_COMMIT_HASH=$(git -C remote rev-parse --short HEAD)" >> $GITHUB_ENV
        echo "SAVED_COMMIT_HASH=$(cat main/dependencies/console-client-commit)" >> $GITHUB_ENV
    - name: echo Remote
      run: echo ${{env.REMOTE_COMMIT_HASH}}
    - name: echo Saved
      run: echo ${{env.SAVED_COMMIT_HASH}}
    - name: Exit if same hash
      if: ${{ env.REMOTE_COMMIT_HASH == env.SAVED_COMMIT_HASH }}
      run: echo "The same hash"
    - name: Commit if not the same
      if: ${{ env.REMOTE_COMMIT_HASH != env.SAVED_COMMIT_HASH }}
      run: echo "${{ env.REMOTE_COMMIT_HASH }}" > main/dependencies/console-client-commit
    - name: Commit changes an push it to remote
      if: ${{ env.REMOTE_COMMIT_HASH != env.SAVED_COMMIT_HASH }}
      uses: actions-x/commit@v6
      with:
        email: 41898282+github-actions[bot]@users.noreply.github.com
        name: GitHub Actions
        branch: master
        files: dependencies/console-client-commit
        repository: https://github.com/DjSni/docker-image-pCloud
        token: ${{ secrets.GITHUB_TOKEN }}
        force: false
        directory: main/
